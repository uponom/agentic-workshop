"""
–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è LLM-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤ –¥–ª—è –ª—é–±—ã—Ö —Ç–µ–º
"""

from strands.models import BedrockModel
import json
import re
import datetime

def generate_smart_naming(user_query: str) -> dict:
    """
    –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–º–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞ –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –ø–æ–º–æ—â—å—é LLM
    """
    
    try:
        # –°–æ–∑–¥–∞–µ–º LLM –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–º–µ–Ω
        naming_model = BedrockModel(
            model_id="us.anthropic.claude-sonnet-4-5-20250929-v1:0",
            temperature=0.1,
        )
        
        naming_prompt = f"""
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–æ–∑–¥–∞–π:
1. –ò–º—è —Ñ–∞–π–ª–∞ (filename) - –∫–æ—Ä–æ—Ç–∫–æ–µ, –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω–æ–µ, –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º, –∏—Å–ø–æ–ª—å–∑—É—è —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è
2. –ó–∞–≥–æ–ª–æ–≤–æ–∫ (title) - –∫—Ä–∞—Å–∏–≤—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

–ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "{user_query}"

–ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞:
- –¢–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è
- –ú–∞–∫—Å–∏–º—É–º 40 —Å–∏–º–≤–æ–ª–æ–≤
- –û—Ç—Ä–∞–∂–∞–µ—Ç —Å—É—Ç—å –∑–∞–ø—Ä–æ—Å–∞
- –ë–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤

–ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞:
- –ù–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –ö—Ä–∞—Å–∏–≤—ã–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π
- –û—Ç—Ä–∞–∂–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –ú–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã

–í–µ—Ä–Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¢–û–õ–¨–ö–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:
{{"filename": "–∏–º—è_—Ñ–∞–π–ª–∞", "title": "–ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞"}}
"""
        
        response = naming_model(naming_prompt)
        
        # –ò–∑–≤–ª–µ–∫–∞–µ–º JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞
        json_start = response.find('{')
        json_end = response.rfind('}') + 1
        
        if json_start != -1 and json_end != -1:
            json_str = response[json_start:json_end]
            result = json.loads(json_str)
            
            filename = result.get('filename', 'aws_architecture')
            title = result.get('title', 'AWS Architecture')
            
            # –û—á–∏—â–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –æ—Ç –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
            filename = re.sub(r'[^\w\-_]', '', filename)
            filename = re.sub(r'_+', '_', filename).strip('_')
            
            if not filename:
                filename = f"aws_architecture_{datetime.datetime.now().strftime('%H%M')}"
            
            return {"filename": filename, "title": title, "success": True}
        
        # Fallback
        timestamp = datetime.datetime.now().strftime("%H%M")
        return {
            "filename": f"aws_architecture_{timestamp}",
            "title": "AWS Cloud Architecture",
            "success": False
        }
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        timestamp = datetime.datetime.now().strftime("%H%M")
        return {
            "filename": f"aws_architecture_{timestamp}",
            "title": "AWS Architecture",
            "success": False
        }

def main():
    """–î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç LLM-–≥–µ–Ω–µ—Ä–∞—Ü–∏—é –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã—Ö —Ç–µ–º"""
    
    print("üöÄ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è LLM-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤")
    print("=" * 60)
    print("LLM —Å–æ–∑–¥–∞–µ—Ç —É–º–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –õ–Æ–ë–´–• —Ç–µ–º, –Ω–µ —Ç–æ–ª—å–∫–æ AWS!")
    print()
    
    # –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ —Ç–µ–º—ã –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
    demo_queries = [
        # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º—ã
        "–°–æ–∑–¥–∞–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ IoT —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ —É–º–Ω–æ–º –≥–æ—Ä–æ–¥–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º AWS",
        
        # –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
        "–°–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è –æ–Ω–ª–∞–π–Ω –æ–±—É—á–µ–Ω–∏—è —Å –≤–∏–¥–µ–æ—Å—Ç—Ä–∏–º–∏–Ω–≥–æ–º, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π",
        
        # –§–∏–Ω–∞–Ω—Å—ã
        "–†–∞–∑—Ä–∞–±–æ—Ç–∞–π —Å–∏—Å—Ç–µ–º—É –∞–Ω–∞–ª–∏–∑–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ä–∏—Å–∫–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –±–∞–Ω–∫–∞",
        
        # –ú–µ–¥–∏—Ü–∏–Ω–∞
        "–°–æ–∑–¥–∞–π —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –∞–Ω–∞–ª–∏–∑–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –º–∞—à–∏–Ω–Ω—ã–º –æ–±—É—á–µ–Ω–∏–µ–º",
        
        # –ò–≥—Ä—ã
        "–°–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –¥–ª—è –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –æ–Ω–ª–∞–π–Ω –∏–≥—Ä—ã —Å –≥–ª–æ–±–∞–ª—å–Ω—ã–º –æ—Ö–≤–∞—Ç–æ–º",
        
        # E-commerce
        "–ü–æ—Å—Ç—Ä–æ–π –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –∫–æ–º–º–µ—Ä—Ü–∏–∏ —Å –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π",
        
        # –¢–µ–ª–µ–∫–æ–º
        "–°–æ–∑–¥–∞–π —Å–∏—Å—Ç–µ–º—É –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –∞–Ω–∞–ª–∏–∑–∞ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–µ–ª–µ–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–æ–Ω–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏",
        
        # –ú–µ–¥–∏–∞
        "–°–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ –º—É–∑—ã–∫–∏ –∏ –ø–æ–¥–∫–∞—Å—Ç–æ–≤ –∫–∞–∫ Spotify",
        
        # –õ–æ–≥–∏—Å—Ç–∏–∫–∞
        "–†–∞–∑—Ä–∞–±–æ—Ç–∞–π —Å–∏—Å—Ç–µ–º—É –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≥—Ä—É–∑–æ–≤ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –¥–ª—è –ª–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –∫–æ–º–ø–∞–Ω–∏–∏",
        
        # –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏
        "–°–æ–∑–¥–∞–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –¥–ª—è —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –≤–∏–¥–µ–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏"
    ]
    
    for i, query in enumerate(demo_queries, 1):
        print(f"üîÑ –ü—Ä–∏–º–µ—Ä {i} –∏–∑ {len(demo_queries)}")
        print(f"üìù –ó–∞–ø—Ä–æ—Å: {query}")
        print("-" * 50)
        
        result = generate_smart_naming(query)
        
        if result['success']:
            print(f"‚úÖ LLM —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª:")
        else:
            print(f"‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω fallback:")
        
        print(f"üìÅ –ò–º—è —Ñ–∞–π–ª–∞: {result['filename']}")
        print(f"üìã –ó–∞–≥–æ–ª–æ–≤–æ–∫: {result['title']}")
        print()
    
    print("=" * 60)
    print("‚ú® –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")
    print()
    print("üí° –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ LLM-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:")
    print("   ‚Ä¢ –†–∞–±–æ—Ç–∞–µ—Ç —Å –õ–Æ–ë–´–ú–ò —Ç–µ–º–∞–º–∏, –Ω–µ —Ç–æ–ª—å–∫–æ AWS")
    print("   ‚Ä¢ –°–æ–∑–¥–∞–µ—Ç –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤")
    print("   ‚Ä¢ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫—Ä–∞—Å–∏–≤—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º")
    print("   ‚Ä¢ –ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –∑–∞–ø—Ä–æ—Å–∞")
    print("   ‚Ä¢ –ù–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤")

if __name__ == "__main__":
    main()
"""
–¢–µ—Å—Ç LLM-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
"""

from strands.models import BedrockModel
import json
import re
import datetime

def test_llm_naming(user_query: str) -> dict:
    """
    –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Å –ø–æ–º–æ—â—å—é LLM
    
    Args:
        user_query: –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        
    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å filename –∏ title
    """
    
    try:
        # –°–æ–∑–¥–∞–µ–º LLM –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–º–µ–Ω
        naming_model = BedrockModel(
            model_id="us.anthropic.claude-sonnet-4-5-20250929-v1:0",
            temperature=0.1,
        )
        
        naming_prompt = f"""
–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–æ–∑–¥–∞–π:
1. –ò–º—è —Ñ–∞–π–ª–∞ (filename) - –∫–æ—Ä–æ—Ç–∫–æ–µ, –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω–æ–µ, –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º, –∏—Å–ø–æ–ª—å–∑—É—è —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è
2. –ó–∞–≥–æ–ª–æ–≤–æ–∫ (title) - –∫—Ä–∞—Å–∏–≤—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

–ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "{user_query}"

–ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞:
- –¢–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è
- –ú–∞–∫—Å–∏–º—É–º 40 —Å–∏–º–≤–æ–ª–æ–≤
- –û—Ç—Ä–∞–∂–∞–µ—Ç —Å—É—Ç—å –∑–∞–ø—Ä–æ—Å–∞
- –ë–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤

–ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞:
- –ù–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –ö—Ä–∞—Å–∏–≤—ã–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π
- –û—Ç—Ä–∞–∂–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –ú–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã

–í–µ—Ä–Ω–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¢–û–õ–¨–ö–û –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:
{{"filename": "–∏–º—è_—Ñ–∞–π–ª–∞", "title": "–ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞"}}
"""
        
        response = naming_model(naming_prompt)
        print(f"ü§ñ LLM –æ—Ç–≤–µ—Ç: {response}")
        
        # –ò–∑–≤–ª–µ–∫–∞–µ–º JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞
        try:
            # –ò—â–µ–º JSON –≤ –æ—Ç–≤–µ—Ç–µ
            json_start = response.find('{')
            json_end = response.rfind('}') + 1
            
            if json_start != -1 and json_end != -1:
                json_str = response[json_start:json_end]
                result = json.loads(json_str)
                
                filename = result.get('filename', 'aws_architecture')
                title = result.get('title', 'AWS Architecture')
                
                # –û—á–∏—â–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –æ—Ç –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
                filename = re.sub(r'[^\w\-_]', '', filename)
                filename = re.sub(r'_+', '_', filename).strip('_')
                
                if not filename:
                    filename = f"aws_architecture_{datetime.datetime.now().strftime('%H%M')}"
                
                return {"filename": filename, "title": title}
            
        except json.JSONDecodeError as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON: {e}")
        
        # Fallback –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON
        timestamp = datetime.datetime.now().strftime("%H%M")
        return {
            "filename": f"aws_architecture_{timestamp}",
            "title": "AWS Cloud Architecture"
        }
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ LLM: {e}")
        # Fallback –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
        timestamp = datetime.datetime.now().strftime("%H%M")
        return {
            "filename": f"aws_architecture_{timestamp}",
            "title": "AWS Architecture"
        }

def main():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç LLM-–≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Å —Ä–∞–∑–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏"""
    
    print("üß™ –¢–µ—Å—Ç LLM-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–º–µ–Ω —Ñ–∞–π–ª–æ–≤ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤")
    print("=" * 60)
    
    test_queries = [
        "–°–æ–∑–¥–∞–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ IoT —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ —É–º–Ω–æ–º –≥–æ—Ä–æ–¥–µ",
        "–°–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è –æ–Ω–ª–∞–π–Ω –æ–±—É—á–µ–Ω–∏—è —Å –≤–∏–¥–µ–æ—Å—Ç—Ä–∏–º–∏–Ω–≥–æ–º",
        "–†–∞–∑—Ä–∞–±–æ—Ç–∞–π —Å–∏—Å—Ç–µ–º—É –∞–Ω–∞–ª–∏–∑–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ä–∏—Å–∫–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏",
        "–°–æ–∑–¥–∞–π —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å ML",
        "–°–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –æ–Ω–ª–∞–π–Ω –∏–≥—Ä—ã",
        "–ü–æ—Å—Ç—Ä–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –¥–ª—è e-commerce —Å –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π",
        "–°–æ–∑–¥–∞–π —Å–∏—Å—Ç–µ–º—É –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–µ–ª–µ–∫–æ–º–µ",
        "–°–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ –º—É–∑—ã–∫–∏ –∫–∞–∫ Spotify"
    ]
    
    for i, query in enumerate(test_queries, 1):
        print(f"\nüîÑ –¢–µ—Å—Ç {i}: {query}")
        print("-" * 50)
        
        result = test_llm_naming(query)
        
        print(f"üìÅ –ò–º—è —Ñ–∞–π–ª–∞: {result['filename']}")
        print(f"üìã –ó–∞–≥–æ–ª–æ–≤–æ–∫: {result['title']}")
        print("‚úÖ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω")
    
    print(f"\n{'='*60}")
    print("‚ú® –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!")
    print("\nüí° –ö–∞–∫ –≤–∏–¥–∏—Ç–µ, LLM —Å–æ–∑–¥–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏")
    print("   –¥–ª—è –ª—é–±—ã—Ö —Ç–µ–º, –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—è—Å—å –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º!")

if __name__ == "__main__":
    main()